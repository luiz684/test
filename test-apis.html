<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das APIs - EduKids</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #FF6B9D 0%, #4ECDC4 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .loading { color: orange; font-weight: bold; }
        button {
            background: #FF6B9D;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #4ECDC4;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .image-test {
            max-width: 300px;
            border-radius: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ü§ñ Teste das APIs - EduKids</h1>
        
        <div class="test-section">
            <h2>üîë Status das Chaves</h2>
            <div id="keys-status">Verificando...</div>
        </div>
        
        <div class="test-section">
            <h2>üß† Teste da API do Gemini</h2>
            <button onclick="testGeminiAPI()">Testar Gemini</button>
            <div id="gemini-result" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2>üñºÔ∏è Teste da API do Unsplash</h2>
            <button onclick="testUnsplashAPI()">Testar Unsplash</button>
            <div id="unsplash-result" class="result" style="display: none;"></div>
            <img id="test-image" class="image-test" style="display: none;" alt="Imagem de teste">
        </div>
        
        <div class="test-section">
            <h2>üéØ Teste Completo de Dica</h2>
            <button onclick="testCompleteHint()">Gerar Dica Completa</button>
            <div id="hint-result" class="result" style="display: none;"></div>
            <img id="hint-image" class="image-test" style="display: none;" alt="Imagem da dica">
        </div>
        
        <div class="test-section">
            <h2>üìä Logs de Debug</h2>
            <div id="debug-logs" class="result" style="max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        let debugLogs = document.getElementById('debug-logs');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'loading' ? 'loading' : '';
            debugLogs.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }
        
        // Verificar status das chaves
        function checkKeysStatus() {
            const geminiKey = getGeminiApiKey();
            const unsplashKey = getUnsplashApiKey();
            
            let status = '';
            
            if (geminiKey && geminiKey !== 'YOUR_GEMINI_API_KEY_HERE') {
                status += '<div class="success">‚úÖ Chave do Gemini configurada</div>';
            } else {
                status += '<div class="error">‚ùå Chave do Gemini n√£o configurada</div>';
            }
            
            if (unsplashKey && unsplashKey !== 'YOUR_UNSPLASH_ACCESS_KEY_HERE') {
                status += '<div class="success">‚úÖ Chave do Unsplash configurada</div>';
            } else {
                status += '<div class="error">‚ùå Chave do Unsplash n√£o configurada</div>';
            }
            
            document.getElementById('keys-status').innerHTML = status;
        }
        
        // Testar API do Gemini
        async function testGeminiAPI() {
            const resultDiv = document.getElementById('gemini-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Testando API do Gemini...</div>';
            
            log('Iniciando teste da API do Gemini...', 'loading');
            
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': getGeminiApiKey()
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: 'Explique o que √© matem√°tica de forma simples para uma crian√ßa de 8 anos. Use emojis e seja divertido!'
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                resultDiv.innerHTML = `<div class="success">‚úÖ Resposta da IA:</div><div>${aiResponse}</div>`;
                log('API do Gemini funcionando perfeitamente!', 'success');
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                log(`Erro na API do Gemini: ${error.message}`, 'error');
            }
        }
        
        // Testar API do Unsplash
        async function testUnsplashAPI() {
            const resultDiv = document.getElementById('unsplash-result');
            const imageDiv = document.getElementById('test-image');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Testando API do Unsplash...</div>';
            
            log('Iniciando teste da API do Unsplash...', 'loading');
            
            try {
                const response = await fetch('https://api.unsplash.com/search/photos?query=matem√°tica educa√ß√£o&per_page=1&client_id=' + getUnsplashApiKey());
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    const imageUrl = data.results[0].urls.regular;
                    resultDiv.innerHTML = '<div class="success">‚úÖ Imagem encontrada!</div>';
                    imageDiv.src = imageUrl;
                    imageDiv.style.display = 'block';
                    log('API do Unsplash funcionando perfeitamente!', 'success');
                } else {
                    throw new Error('Nenhuma imagem encontrada');
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                log(`Erro na API do Unsplash: ${error.message}`, 'error');
            }
        }
        
        // Teste completo de dica
        async function testCompleteHint() {
            const resultDiv = document.getElementById('hint-result');
            const imageDiv = document.getElementById('hint-image');
            
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">Gerando dica completa...</div>';
            
            log('Iniciando teste completo de dica...', 'loading');
            
            try {
                // Simular a fun√ß√£o de gera√ß√£o de dica do app
                const question = "Jo√£o tem 5 balas e ganhou mais 3. Quantas balas ele tem agora?";
                const subjectName = "Matem√°tica";
                
                const prompt = `Voc√™ √© um professor especialista em ${subjectName} para crian√ßas de 8-11 anos. 
                
                Pergunta: "${question}"
                
                Gere uma dica educativa, divertida e motivadora que:
                1. Use linguagem MUITO simples e amig√°vel para crian√ßas de 8-11 anos
                2. Use emojis coloridos e divertidos
                3. Seja espec√≠fica para a pergunta, mas N√ÉO d√™ a resposta direta
                4. Ajude a crian√ßa a pensar passo a passo
                5. Seja encorajadora e positiva
                6. Use exemplos concretos e visuais
                7. Tenha no m√°ximo 2 frases curtas
                8. Use palavras que crian√ßas de 8-11 anos entendem
                
                Formato da resposta (JSON):
                {
                    "text": "sua dica aqui com emojis",
                    "image_prompt": "imagem educativa simples para crian√ßas sobre o tema"
                }`;
                
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-goog-api-key': getGeminiApiKey()
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                
                // Extrair JSON da resposta
                const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const hintData = JSON.parse(jsonMatch[0]);
                    
                    resultDiv.innerHTML = `<div class="success">‚úÖ Dica gerada com sucesso!</div><div>${hintData.text}</div>`;
                    
                    // Buscar imagem com termos espec√≠ficos para crian√ßas
                    const searchTerms = ['kids math', 'children counting', 'elementary math', 'numbers for kids', 'math games'];
                    let imageFound = false;
                    
                    for (const term of searchTerms) {
                        const imageResponse = await fetch(`https://api.unsplash.com/search/photos?query=${encodeURIComponent(term)}&per_page=1&client_id=` + getUnsplashApiKey());
                        if (imageResponse.ok) {
                            const imageData = await imageResponse.json();
                            if (imageData.results && imageData.results.length > 0) {
                                imageDiv.src = imageData.results[0].urls.regular;
                                imageDiv.style.display = 'block';
                                imageFound = true;
                                break;
                            }
                        }
                    }
                    
                    if (!imageFound) {
                        // Fallback para imagem educativa
                        imageDiv.src = 'https://images.unsplash.com/photo-1509228468518-180dd4864904?w=300&h=200&fit=crop&q=80';
                        imageDiv.style.display = 'block';
                    }
                    
                    log('Dica completa gerada com sucesso!', 'success');
                } else {
                    throw new Error('Resposta da IA n√£o cont√©m JSON v√°lido');
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
                log(`Erro na gera√ß√£o de dica: ${error.message}`, 'error');
            }
        }
        
        // Inicializar
        checkKeysStatus();
        log('P√°gina de teste carregada', 'success');
    </script>
</body>
</html>
