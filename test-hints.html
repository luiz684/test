<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste do Sistema de Dicas - EduKids</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            background: #f9f9f9;
        }
        
        .test-section h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .question {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        
        .hint-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
            transition: transform 0.2s;
        }
        
        .hint-button:hover {
            transform: translateY(-2px);
        }
        
        .hint-result {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: none;
        }
        
        .hint-result.show {
            display: block;
        }
        
        .hint-text {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .hint-image {
            max-width: 300px;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .loading {
            color: #667eea;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Teste do Sistema de Dicas Inteligentes</h1>
        
        <div class="test-section">
            <h3>üìö Matem√°tica</h3>
            <div class="question">
                <strong>Pergunta:</strong> Jo√£o tem 5 balas e ganhou mais 3. Quantas balas ele tem agora?
                <br><strong>Op√ß√µes:</strong> 6, 7, 8, 9
                <br><button class="hint-button" onclick="testHint('matematica', 'Jo√£o tem 5 balas e ganhou mais 3. Quantas balas ele tem agora?', ['6', '7', '8', '9'])">üéØ Testar Dica</button>
                <div class="hint-result" id="hint-matematica">
                    <div class="hint-text"></div>
                    <img class="hint-image" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üìù Portugu√™s</h3>
            <div class="question">
                <strong>Pergunta:</strong> Se eu tenho uma casa e ganho mais uma, quantas casas eu tenho?
                <br><strong>Op√ß√µes:</strong> casas, casaes, casases, casa
                <br><button class="hint-button" onclick="testHint('portugues', 'Se eu tenho uma casa e ganho mais uma, quantas casas eu tenho?', ['casas', 'casaes', 'casases', 'casa'])">üìù Testar Dica</button>
                <div class="hint-result" id="hint-portugues">
                    <div class="hint-text"></div>
                    <img class="hint-image" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üî¨ Ci√™ncias</h3>
            <div class="question">
                <strong>Pergunta:</strong> Qual √© o maior √≥rg√£o do nosso corpo?
                <br><strong>Op√ß√µes:</strong> Cora√ß√£o, C√©rebro, Pele, F√≠gado
                <br><button class="hint-button" onclick="testHint('ciencias', 'Qual √© o maior √≥rg√£o do nosso corpo?', ['Cora√ß√£o', 'C√©rebro', 'Pele', 'F√≠gado'])">üî¨ Testar Dica</button>
                <div class="hint-result" id="hint-ciencias">
                    <div class="hint-text"></div>
                    <img class="hint-image" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>üé® Artes</h3>
            <div class="question">
                <strong>Pergunta:</strong> Qual cor √© formada pela mistura de azul e amarelo?
                <br><strong>Op√ß√µes:</strong> Roxo, Verde, Laranja, Rosa
                <br><button class="hint-button" onclick="testHint('artes', 'Qual cor √© formada pela mistura de azul e amarelo?', ['Roxo', 'Verde', 'Laranja', 'Rosa'])">üé® Testar Dica</button>
                <div class="hint-result" id="hint-artes">
                    <div class="hint-text"></div>
                    <img class="hint-image" style="display: none;">
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>‚öΩ Esportes</h3>
            <div class="question">
                <strong>Pergunta:</strong> Quantos jogadores tem um time de futebol?
                <br><strong>Op√ß√µes:</strong> 10, 11, 12, 13
                <br><button class="hint-button" onclick="testHint('esportes', 'Quantos jogadores tem um time de futebol?', ['10', '11', '12', '13'])">‚öΩ Testar Dica</button>
                <div class="hint-result" id="hint-esportes">
                    <div class="hint-text"></div>
                    <img class="hint-image" style="display: none;">
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // Simula o sistema de dicas do EduKids
        class HintTester {
            constructor() {
                this.subjects = {
                    'matematica': 'Matem√°tica',
                    'portugues': 'Portugu√™s', 
                    'ciencias': 'Ci√™ncias',
                    'artes': 'Artes',
                    'esportes': 'Esportes'
                };
            }
            
            async testHint(subjectKey, question, options) {
                const subjectName = this.subjects[subjectKey];
                const hintContainer = document.getElementById(`hint-${subjectKey}`);
                const hintText = hintContainer.querySelector('.hint-text');
                const hintImage = hintContainer.querySelector('.hint-image');
                
                // Mostra loading
                hintText.innerHTML = '<span class="loading">üß† Gerando dica super inteligente...</span>';
                hintContainer.classList.add('show');
                
                try {
                    // Primeiro tenta dica inteligente pr√©-definida
                    const smartHint = this.getSmartHint({question, options}, subjectName);
                    if (smartHint) {
                        hintText.innerHTML = smartHint.text;
                        if (smartHint.image) {
                            hintImage.src = smartHint.image;
                            hintImage.style.display = 'block';
                        } else {
                            hintImage.style.display = 'none';
                        }
                    } else {
                        // Se n√£o tem dica pr√©-definida, usa IA melhorada
                        const aiHint = await this.generateEnhancedAIHint({question, options}, subjectName);
                        if (aiHint) {
                            hintText.innerHTML = aiHint.text;
                            if (aiHint.image) {
                                hintImage.src = aiHint.image;
                                hintImage.style.display = 'block';
                            }
                        } else {
                            hintText.innerHTML = '‚ùå Erro ao gerar dica';
                            hintImage.style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    hintText.innerHTML = '‚ùå Erro ao gerar dica';
                    hintImage.style.display = 'none';
                }
            }
            
            getSmartHint(question, subjectName) {
                const questionText = question.question.toLowerCase();
                
                // Dicas de contexto para Matem√°tica - foca no processo, n√£o na resposta
                if (subjectName === 'Matem√°tica') {
                    if (questionText.includes('balas') || questionText.includes('brinquedos') || questionText.includes('doces')) {
                        return {
                            text: 'üéØ Quando voc√™ tem algumas coisas e ganha mais, que opera√ß√£o matem√°tica voc√™ faz? Pense em somar! ‚ûï',
                            image: 'https://images.unsplash.com/photo-1509228468518-180dd4864904?w=400&h=300&fit=crop&q=80'
                        };
                    }
                }
                
                // Dicas de contexto para Portugu√™s - foca nas regras, n√£o nas respostas
                if (subjectName === 'Portugu√™s') {
                    if (questionText.includes('plural') || questionText.includes('casas')) {
                        return {
                            text: 'üìù Quando temos mais de uma coisa, como mudamos a palavra? Pense em adicionar uma letra no final! üî§',
                            image: 'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=300&fit=crop&q=80'
                        };
                    }
                }
                
                // Dicas de contexto para Ci√™ncias - foca em caracter√≠sticas, n√£o em nomes
                if (subjectName === 'Ci√™ncias') {
                    if (questionText.includes('√≥rg√£o') || questionText.includes('pele')) {
                        return {
                            text: 'ü¶æ Qual parte do nosso corpo cobre tudo e nos protege? √â o que vemos por fora! üõ°Ô∏è',
                            image: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop&q=80'
                        };
                    }
                }
                
                // Dicas de contexto para Artes - foca em t√©cnicas e caracter√≠sticas
                if (subjectName === 'Artes') {
                    if (questionText.includes('cor') || questionText.includes('azul') || questionText.includes('amarelo')) {
                        return {
                            text: 'üé® Misture azul + amarelo! √â como misturar tinta! Que cor voc√™ acha que vai dar? üñåÔ∏è',
                            image: 'https://images.unsplash.com/photo-1541701494587-cb58502866ab?w=400&h=300&fit=crop&q=80'
                        };
                    }
                }
                
                // Dicas de contexto para Esportes - foca em regras e caracter√≠sticas
                if (subjectName === 'Esportes') {
                    if (questionText.includes('futebol') || questionText.includes('jogadores')) {
                        return {
                            text: '‚öΩ Um time de futebol tem 11 jogadores: 10 em campo + 1 goleiro! Conte no campo! ü•Ö',
                            image: 'https://images.unsplash.com/photo-1431324155629-1a6deb1dec8d?w=400&h=300&fit=crop&q=80'
                        };
                    }
                }
                
                return null;
            }
            
            async generateEnhancedAIHint(question, subjectName) {
                try {
                    if (!checkApiKeys()) {
                        throw new Error('Chaves da API n√£o configuradas');
                    }
                    
                    const API_KEY = getGeminiApiKey();
                    
                    const prompt = `Voc√™ √© um professor especialista em ${subjectName} para crian√ßas de 8-11 anos. 

Pergunta: "${question.question}"
Op√ß√µes: ${question.options.join(', ')}

CONTEXTO ESPEC√çFICO:
- Mat√©ria: ${subjectName}
- Faixa et√°ria: 8-11 anos
- N√≠vel: Ensino Fundamental

INSTRU√á√ïES R√çGIDAS - DICAS DE CONTEXTO:
1. Use APENAS linguagem que crian√ßas de 8-11 anos entendem perfeitamente
2. Use MUITOS emojis coloridos e divertidos (pelo menos 3-4 por dica)
3. NUNCA d√™ a resposta direta - apenas d√™ pistas sobre caracter√≠sticas
4. Foque em CONTEXTO e CARACTER√çSTICAS, n√£o em nomes espec√≠ficos
5. Use exemplos concretos e visuais que a crian√ßa pode imaginar
6. Seja encorajador e positivo
7. M√°ximo 2 frases curtas e simples
8. Use analogias simples (como "√© como...", "imagine que...")
9. D√™ pistas sobre o que procurar, n√£o a resposta

EXEMPLOS DE BOAS DICAS DE CONTEXTO:
- Hist√≥ria: "üö¢ Era um navegador portugu√™s, que chegou aqui em 1500. Foi uma grande descoberta! üó∫Ô∏è"
- Ci√™ncias: "ü¶æ Qual parte do nosso corpo cobre tudo e nos protege? √â o que vemos por fora! üõ°Ô∏è"
- Matem√°tica: "üéØ Quando voc√™ tem algumas coisas e ganha mais, que opera√ß√£o matem√°tica voc√™ faz? Pense em somar! ‚ûï"
- Portugu√™s: "üìù Quando temos mais de uma coisa, como mudamos a palavra? Pense em adicionar uma letra no final! üî§"
- Ingl√™s: "üè† √â onde moramos com nossa fam√≠lia! Em ingl√™s, come√ßa com 'H'! üë®‚Äçüë©‚Äçüëß‚Äçüë¶"

Formato da resposta (JSON):
{
    "text": "sua dica de contexto aqui com emojis",
    "image_prompt": "imagem educativa simples para crian√ßas sobre o tema espec√≠fico"
}`;
                    
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-goog-api-key': API_KEY
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }]
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const aiResponse = data.candidates[0].content.parts[0].text;
                    
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const hintData = JSON.parse(jsonMatch[0]);
                        
                        const imageUrl = await this.generateEnhancedImage(hintData.image_prompt, subjectName);
                        
                        return {
                            text: hintData.text,
                            image: imageUrl
                        };
                    } else {
                        throw new Error('Resposta da IA n√£o cont√©m JSON v√°lido');
                    }
                    
                } catch (error) {
                    console.error('Erro na API do Gemini:', error);
                    throw error;
                }
            }
            
            async generateEnhancedImage(prompt, subjectName) {
                try {
                    const unsplashAccessKey = getUnsplashApiKey();
                    const searchTerms = this.getSubjectSpecificSearchTerms(prompt, subjectName);
                    
                    for (const term of searchTerms) {
                        const searchQuery = encodeURIComponent(term);
                        const searchResponse = await fetch(`https://api.unsplash.com/search/photos?query=${searchQuery}&per_page=3&client_id=${unsplashAccessKey}`);
                        
                        if (searchResponse.ok) {
                            const searchData = await searchResponse.json();
                            if (searchData.results && searchData.results.length > 0) {
                                const bestImage = searchData.results[0];
                                return bestImage.urls.regular;
                            }
                        }
                    }
                    
                    return this.getEducationalImage(prompt);
                    
                } catch (error) {
                    console.error('Erro ao gerar imagem:', error);
                    return this.getEducationalImage(prompt);
                }
            }
            
            getSubjectSpecificSearchTerms(prompt, subjectName) {
                const subjectTerms = {
                    'Matem√°tica': {
                        'contar': ['kids counting fingers', 'children math', 'elementary counting', 'kids numbers'],
                        'somar': ['kids addition', 'children math', 'elementary addition', 'kids plus'],
                        'geral': ['kids math', 'children mathematics', 'elementary math', 'kids numbers', 'children counting']
                    },
                    'Portugu√™s': {
                        'plural': ['kids grammar', 'children language', 'elementary grammar', 'kids words'],
                        'geral': ['kids reading', 'children books', 'elementary language', 'kids writing', 'children literacy']
                    },
                    'Ci√™ncias': {
                        'corpo': ['kids body', 'children anatomy', 'elementary biology', 'kids health'],
                        'geral': ['kids science', 'children nature', 'elementary science', 'kids biology', 'children discovery']
                    },
                    'Artes': {
                        'cores': ['kids colors', 'children painting', 'elementary art', 'kids rainbow'],
                        'geral': ['kids art', 'children creativity', 'elementary art', 'kids drawing', 'children painting']
                    },
                    'Esportes': {
                        'futebol': ['kids soccer', 'children football', 'elementary sports', 'kids ball'],
                        'geral': ['kids sports', 'children playing', 'elementary sports', 'kids exercise', 'children games']
                    }
                };
                
                const promptLower = prompt.toLowerCase();
                const subjectData = subjectTerms[subjectName] || subjectTerms['Matem√°tica'];
                
                for (const [keyword, terms] of Object.entries(subjectData)) {
                    if (keyword !== 'geral' && promptLower.includes(keyword)) {
                        return terms;
                    }
                }
                
                return subjectData['geral'] || ['kids learning', 'children education', 'elementary school'];
            }
            
            getEducationalImage(prompt) {
                const fallbackImages = [
                    'https://images.unsplash.com/photo-1509228468518-180dd4864904?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1481627834876-b7833e8f5570?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1541701494587-cb58502866ab?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1431324155629-1a6deb1dec8d?w=400&h=300&fit=crop&q=80'
                ];
                return fallbackImages[Math.floor(Math.random() * fallbackImages.length)];
            }
        }
        
        const hintTester = new HintTester();
        
        function testHint(subject, question, options) {
            hintTester.testHint(subject, question, options);
        }
    </script>
</body>
</html>
